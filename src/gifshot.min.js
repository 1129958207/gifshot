!function(e,t,r,i){"use strict";function n(){return v.isValid()}function o(){function e(){for(var e=[],t=new Array(m),r=0;r<m;r++)t[u[r][3]]=r;for(var i=0,n=0;n<m;n++){var o=t[n];e[i++]=u[o][0],e[i++]=u[o][1],e[i++]=u[o][2]}return e}function t(){var e,t,r,i,n,o,a,s;for(a=0,s=0,e=0;e<m;e++){for(r=e,i=(n=u[e])[1],t=e+1;t<m;t++)(o=u[t])[1]<i&&(r=t,i=o[1]);if(o=u[r],e!=r&&(t=o[0],o[0]=n[0],n[0]=t,t=o[1],o[1]=n[1],n[1]=t,t=o[2],o[2]=n[2],n[2]=t,t=o[3],o[3]=n[3],n[3]=t),i!=a){for(T[a]=s+e>>1,t=a+1;t<i;t++)T[t]=e;a=i,s=e}}for(T[a]=s+b>>1,t=a+1;t<256;t++)T[t]=b}function r(){var e,t,r,i,u,m,b,C,S,k,x,F,W,M;for(c<v&&(l=1),s=30+(l-1)/3,F=d,W=0,M=c,k=(x=c/(3*l))/y|0,C=U,(b=(m=O)>>E)<=1&&(b=0),e=0;e<b;e++)j[e]=C*((b*b-e*e)*R/(b*b));for(S=c<v?3:c%f!=0?3*f:c%g!=0?3*g:c%h!=0?3*h:3*p,e=0;e<x;)if(r=(255&F[W+0])<<w,i=(255&F[W+1])<<w,u=(255&F[W+2])<<w,t=a(r,i,u),o(C,t,r,i,u),0!==b&&n(b,t,r,i,u),(W+=S)>=M&&(W-=c),e++,0===k&&(k=1),e%k==0)for(C-=C/s,(b=(m-=m/A)>>E)<=1&&(b=0),t=0;t<b;t++)j[t]=C*((b*b-t*t)*R/(b*b))}function i(){var e;for(e=0;e<m;e++)u[e][0]>>=w,u[e][1]>>=w,u[e][2]>>=w,u[e][3]=e}function n(e,t,r,i,n){var o,a,s,d,c,l,f;for((s=t-e)<-1&&(s=-1),(d=t+e)>m&&(d=m),o=t+1,a=t-1,l=1;o<d||a>s;){if(c=j[l++],o<d){f=u[o++];try{f[0]-=c*(f[0]-r)/M|0,f[1]-=c*(f[1]-i)/M|0,f[2]-=c*(f[2]-n)/M|0}catch(e){}}if(a>s){f=u[a--];try{f[0]-=c*(f[0]-r)/M|0,f[1]-=c*(f[1]-i)/M|0,f[2]-=c*(f[2]-n)/M|0}catch(e){}}}}function o(e,t,r,i,n){var o=u[t],a=e/U;o[0]-=a*(o[0]-r)|0,o[1]-=a*(o[1]-i)|0,o[2]-=a*(o[2]-n)|0}function a(e,t,r){var i,n,o,a,s,d,c,l,f,g;for(f=l=~(1<<31),c=d=-1,i=0;i<m;i++)(n=(g=u[i])[0]-e)<0&&(n=-n),(o=g[1]-t)<0&&(o=-o),n+=o,(o=g[2]-r)<0&&(o=-o),(n+=o)<l&&(l=n,d=i),(a=n-(I[i]>>C-w))<f&&(f=a,c=i),s=V[i]>>x,V[i]-=s,I[i]+=s<<k;return V[d]+=F,I[d]-=W,c}var s,d,c,l,u,m=256,f=499,g=491,h=487,p=503,v=3*p,b=m-1,w=4,y=100,C=16,S=1<<C,k=10,x=10,F=S>>x,W=S<<k-x,E=6,O=(m>>3)*(1<<E),A=30,U=1024,R=256,M=1<<18,T=[],I=[],V=[],j=[];(function(e,t,r){var i,n;for(d=e,c=t,l=r,u=new Array(m),i=0;i<m;i++)u[i]=new Array(4),(n=u[i])[0]=n[1]=n[2]=(i<<w+8)/m|0,V[i]=S/m|0,I[i]=0}).apply(this,arguments);var z={};return z.map=function(e,t,r){var i,n,o,a,s,d,c;for(s=1e3,c=-1,n=(i=T[t])-1;i<m||n>=0;)i<m&&((o=(d=u[i])[1]-t)>=s?i=m:(i++,o<0&&(o=-o),(a=d[0]-e)<0&&(a=-a),(o+=a)<s&&((a=d[2]-r)<0&&(a=-a),(o+=a)<s&&(s=o,c=d[3])))),n>=0&&((o=t-(d=u[n])[1])>=s?n=-1:(n--,o<0&&(o=-o),(a=d[0]-e)<0&&(a=-a),(o+=a)<s&&((a=d[2]-r)<0&&(a=-a),(o+=a)<s&&(s=o,c=d[3]))));return c},z.process=function(){return r(),i(),t(),e()},z}function a(){var e=this;try{e.onmessage=function(e){var r,i=e.data||{};i.gifshot&&(r=t.run(i),postMessage(r))}}catch(e){}var t={dataToRGB:function(e,t,r){for(var i=t*r*4,n=0,o=[];n<i;)o.push(e[n++]),o.push(e[n++]),o.push(e[n++]),n++;return o},componentizedPaletteToArray:function(e){var t=[],r=void 0,i=void 0,n=void 0,o=void 0;for(r=0;r<e.length;r+=3)i=e[r],n=e[r+1],o=e[r+2],t.push(i<<16|n<<8|o);return t},processFrameWithQuantizer:function(e,t,r,i){var n=this.dataToRGB(e,t,r),a=new o(n,n.length,i),s=a.process(),d=new Uint32Array(this.componentizedPaletteToArray(s)),c=t*r,l=new Uint8Array(c),u=0,m=void 0,f=void 0,g=void 0,h=void 0;for(m=0;m<c;m++)f=n[u++],g=n[u++],h=n[u++],l[m]=a.map(f,g,h);return{pixels:l,palette:d}},run:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.height,r=(e.palette,e.sampleInterval),n=e.width,o=e.data;return this.processFrameWithQuantizer(o,n,t,r)}};return t}function s(e,t,r,n){function o(e){var t=e.length;if(t<2||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}function a(e,t,r,n){function o(r){for(;f>=r;)e[t++]=255&g,g>>=8,f-=8,t===s+256&&(e[s]=255,s=t++)}function a(e){g|=e<<f,f+=m,o(8)}e[t++]=r;var s=t++,d=1<<r,c=d-1,l=d+1,u=l+1,m=r+1,f=0,g=0,h=n[0]&c,p={};a(d);for(var v=1,b=n.length;v<b;++v){var w=n[v]&c,y=h<<8|w,C=p[y];if(C===i){for(g|=h<<f,f+=m;f>=8;)e[t++]=255&g,g>>=8,f-=8,t===s+256&&(e[s]=255,s=t++);4096===u?(a(d),u=l+1,m=r+1,p={}):(u>=1<<m&&++m,p[y]=u++),h=w}else h=C}return a(h),a(l),o(1),s+1===t?e[s]=0:(e[s]=t-s-1,e[t++]=0),t}var s=0,d=(n=n===i?{}:n).loop===i?null:n.loop,c=n.palette===i?null:n.palette;if(t<=0||r<=0||t>65535||r>65535)throw"Width/Height invalid.";e[s++]=71,e[s++]=73,e[s++]=70,e[s++]=56,e[s++]=57,e[s++]=97;if(e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=0|(null!==c?128:0),e[s++]=0,e[s++]=0,null!==d){if(d<0||d>65535)throw"Loop count invalid.";e[s++]=33,e[s++]=255,e[s++]=11,e[s++]=78,e[s++]=69,e[s++]=84,e[s++]=83,e[s++]=67,e[s++]=65,e[s++]=80,e[s++]=69,e[s++]=50,e[s++]=46,e[s++]=48,e[s++]=3,e[s++]=1,e[s++]=255&d,e[s++]=d>>8&255,e[s++]=0}var l=!1;this.addFrame=function(t,r,n,d,u,m){if(!0===l&&(--s,l=!1),m=m===i?{}:m,t<0||r<0||t>65535||r>65535)throw"x/y invalid.";if(n<=0||d<=0||n>65535||d>65535)throw"Width/Height invalid.";if(u.length<n*d)throw"Not enough pixels for the frame size.";var f=!0,g=m.palette;if(g!==i&&null!==g||(f=!1,g=c),g===i||null===g)throw"Must supply either a local or global palette.";for(var h=o(g),p=0;h>>=1;)++p;h=1<<p;var v=m.delay===i?0:m.delay,b=m.disposal===i?0:m.disposal;if(b<0||b>3)throw"Disposal out of range.";var w=!1,y=0;if(m.transparent!==i&&null!==m.transparent&&(w=!0,(y=m.transparent)<0||y>=h))throw"Transparent color index.";if((0!==b||w||0!==v)&&(e[s++]=33,e[s++]=249,e[s++]=4,e[s++]=b<<2|(!0===w?1:0),e[s++]=255&v,e[s++]=v>>8&255,e[s++]=y,e[s++]=0),e[s++]=44,e[s++]=255&t,e[s++]=t>>8&255,e[s++]=255&r,e[s++]=r>>8&255,e[s++]=255&n,e[s++]=n>>8&255,e[s++]=255&d,e[s++]=d>>8&255,e[s++]=!0===f?128|p-1:0,!0===f)for(var C=0,S=g.length;C<S;++C){var k=g[C];e[s++]=k>>16&255,e[s++]=k>>8&255,e[s++]=255&k}s=a(e,s,p<2?2:p,u)},this.end=function(){return!1===l&&(e[s++]=59,l=!0),s}}function d(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})}function c(){function e(){h.each(u,function(e,t){t&&(t.text?g.addFrame(t.img,a,t.text):g.addFrame(t,a))}),d(g,n)}var r=arguments.length>0&&arguments[0]!==i?arguments[0]:{},n=r.callback,o=r.images,a=r.options,s=r.imagesLength,c={getUserMedia:!0,"window.URL":!0},l=v.validate(c),u=[],m=0,f=void 0,g=void 0;if(l.error)return n(l);g=new k(a),h.each(o,function(r,i){var o=i;i.src&&(o=o.src),h.isElement(o)?(a.crossOrigin&&(o.crossOrigin=a.crossOrigin),u[r]=o,(m+=1)===s&&e()):h.isString(o)&&(f=new Image,a.crossOrigin&&(f.crossOrigin=a.crossOrigin),function(t){i.text&&(t.text=i.text),t.onerror=function(e){var t=void 0;if(0==--s)return t={},t.error="None of the requested images was capable of being retrieved",n(t)},t.onload=function(n){i.text?u[r]={img:t,text:t.text}:u[r]=t,(m+=1)===s&&e(),h.removeElement(t)},t.src=o}(f),h.setCSSAttr(f,{position:"fixed",opacity:"0"}),t.body.appendChild(f))})}function l(e){e=h.isObject(e)?e:{},W.stopVideoStreaming(e)}function u(e,r){var i=e.options||{},n=i.images,o=i.video,a=Number(i.gifWidth),s=Number(i.gifHeight),d=(Number(i.numFrames),e.cameraStream),c=e.videoElement,u=e.videoWidth,m=e.videoHeight,f=F.getCropDimensions({videoWidth:u,videoHeight:m,gifHeight:s,gifWidth:a}),g=r;i.crop=f,i.videoElement=c,i.videoWidth=u,i.videoHeight=m,i.cameraStream=d,h.isElement(c)&&(c.width=a+f.width,c.height=s+f.height,i.webcamVideoElement||(h.setCSSAttr(c,{position:"fixed",opacity:"0"}),t.body.appendChild(c)),c.play(),F.getGIF(i,function(e){n&&n.length||o&&o.length||l(e),g(e)}))}function m(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.callback,r=e.existingVideo,n=e.options,o={getUserMedia:!0,"window.URL":!0},a=v.validate(o),s=void 0,d=void 0;if(a.error)return t(a);if(h.isElement(r)&&r.src){if(d=r.src,s=h.getExtension(d),!h.isSupported.videoCodecs[s])return t(v.messages.videoCodecs)}else h.isArray(r)&&h.each(r,function(e,t){if(s=t instanceof Blob?t.type.substr(t.type.lastIndexOf("/")+1,t.length):t.substr(t.lastIndexOf(".")+1,t.length),h.isSupported.videoCodecs[s])return r=t,!1});W.startStreaming({completed:function(e){e.options=n||{},u(e,t)},existingVideo:r,crossOrigin:n.crossOrigin,options:n})}function f(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.callback,r=e.lastCameraStream,o=e.options,a=e.webcamVideoElement;if(!n())return t(v.validate());o.savedRenderingContexts.length?F.getGIF(o,function(e){t(e)}):W.startVideoStreaming(function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};e.options=o||{},u(e,t)},{lastCameraStream:r,callback:t,webcamVideoElement:a,crossOrigin:o.crossOrigin})}function g(e,t){if(t=h.isFunction(e)?e:t,e=h.isObject(e)?e:{},h.isFunction(t)){var r=h.mergeOptions(y,e)||{},i=e.cameraStream,n=r.images,o=n?n.length:0,a=r.video,s=r.webcamVideoElement;r=h.mergeOptions(r,{gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)}),o?c({images:n,imagesLength:o,callback:t,options:r}):a?m({existingVideo:a,callback:t,options:r}):f({lastCameraStream:i,callback:t,webcamVideoElement:s,options:r})}}var h={URL:e.URL||e.webkitURL||e.mozURL||e.msURL,getUserMedia:function(){var e=r.getUserMedia||r.webkitGetUserMedia||r.mozGetUserMedia||r.msGetUserMedia;return e?e.bind(r):e}(),requestAnimFrame:e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame,requestTimeout:function(e,t){if(e=e||h.noop,t=t||0,!h.requestAnimFrame)return setTimeout(e,t);var r=(new Date).getTime(),i=new Object,n=h.requestAnimFrame;return i.value=n(function o(){(new Date).getTime()-r>=t?e.call():i.value=n(o)}),i},Blob:e.Blob||e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||e.MSBlobBuilder,btoa:function(){var t=e.btoa||function(e){for(var t="",r=0,i=e.length,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,a=void 0,s=void 0,d=void 0,c=void 0,l=void 0,u=void 0;r<i;)d=(o=e.charCodeAt(r++))>>2,c=(3&o)<<4|(a=e.charCodeAt(r++))>>4,l=(15&a)<<2|(s=e.charCodeAt(r++))>>6,u=63&s,isNaN(a)?l=u=64:isNaN(s)&&(u=64),t=t+n.charAt(d)+n.charAt(c)+n.charAt(l)+n.charAt(u);return t};return t?t.bind(e):h.noop}(),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return h.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=t.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:function(){return e.Worker},blob:function(){return h.Blob},Uint8Array:function(){return e.Uint8Array},Uint32Array:function(){return e.Uint32Array},videoCodecs:function(){var e=t.createElement("video"),r={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(r.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),r.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),r.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),r.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),r.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(e){}return r}()},noop:function(){},each:function(e,t){var r=void 0,i=void 0;if(h.isArray(e))for(r=-1,i=e.length;++r<i&&!1!==t(r,e[r]););else if(h.isObject(e))for(r in e)if(e.hasOwnProperty(r)&&!1===t(r,e[r]))break},mergeOptions:function(e,t){if(h.isObject(e)&&h.isObject(t)&&Object.keys){var r={};return h.each(e,function(t,i){r[t]=e[t]}),h.each(t,function(i,n){var o=t[i];h.isObject(o)&&e[i]?r[i]=h.mergeOptions(e[i],o):r[i]=o}),r}},setCSSAttr:function(e,t,r){h.isElement(e)&&(h.isString(t)&&h.isString(r)?e.style[t]=r:h.isObject(t)&&h.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){h.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!h.isString(e))return{};try{var t=new h.Blob([e],{type:"text/javascript"}),r=h.URL.createObjectURL(t);return{objectUrl:r,worker:new Worker(r)}}catch(e){return""+e}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{};if(!t.body||!1===e.resizeFont)return e.fontSize;var r=e.text,n=e.gifWidth,o=parseInt(e.fontSize,10),a=parseInt(e.minFontSize,10),s=t.createElement("div"),d=t.createElement("span");for(s.setAttribute("width",n),s.appendChild(d),d.innerHTML=r,d.style.fontSize=o+"px",d.style.textIndent="-9999px",d.style.visibility="hidden",t.body.appendChild(d);d.offsetWidth>n&&o>=a;)d.style.fontSize=--o+"px";return t.body.removeChild(d),o+"px"},webWorkerError:!1},p=Object.freeze({default:h}),v={validate:function(e){e=h.isObject(e)?e:{};var t={};return h.each(v.validators,function(r,i){var n=i.errorCode;if(!e[n]&&!i.condition)return t=i,t.error=!0,!1}),delete t.condition,t},isValid:function(e){var t=!0!==v.validate(e).error;return t},validators:[{condition:h.isFunction(h.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:h.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:h.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:h.isFunction(h.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:h.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:h.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:h.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},b=Object.freeze({default:v}),w=function(){},y={sampleInterval:10,numWorkers:2,gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:w,completeCallback:w,saveRenderingContexts:!1,savedRenderingContexts:[],crossOrigin:"Anonymous"},C=Object.freeze({default:y}),S=function(){},k=function(e){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=S,this.onRenderProgressCallback=S,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e,this.initializeWebWorkers(e)};k.prototype={workerMethods:a(),initializeWebWorkers:function(e){var r=this,i=o.toString()+"("+a.toString()+"());",n=void 0,s=void 0,d=void 0,c=void 0,l=-1,u="";for(c=e.numWorkers;++l<c;)n=h.createWebWorker(i),h.isObject(n)?(s=n.objectUrl,d=n.worker,r.workers.push({worker:d,objectUrl:s}),r.availableWorkers.push(d)):(u=n,h.webWorkerError=!!n);this.workerError=u,this.canvas=t.createElement("canvas"),this.canvas.width=e.gifWidth,this.canvas.height=e.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(e){this.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;t<256;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",i=-1;++i<t;)r+=this.byteMap[e[i]];return r},onFrameFinished:function(e){var t=this,r=t.frames,i=!!(t.options.images||[]).length,n=r.every(function(e){return!e.beingProcessed&&e.done});t.numRenderedFrames++,i&&e(t.numRenderedFrames/r.length),t.onRenderProgressCallback(.75*t.numRenderedFrames/r.length),n?t.generatingGIF||t.generateGIF(r,t.onRenderCompleteCallback):h.requestTimeout(function(){t.processNextFrame()},1)},processFrame:function(e){var t=this,r=(this.options,this.options),n=r.progressCallback,o=r.sampleInterval,a=this.frames,s=void 0,d=void 0,c=function(){var e=(arguments.length>0&&arguments[0]!==i?arguments[0]:{}).data;delete s.data,s.pixels=Array.prototype.slice.call(e.pixels),s.palette=Array.prototype.slice.call(e.palette),s.done=!0,s.beingProcessed=!1,t.freeWorker(d),t.onFrameFinished(n)};(s=a[e]).beingProcessed||s.done?this.onFrameFinished():(s.sampleInterval=o,s.beingProcessed=!0,s.gifshot=!0,(d=this.getWorker())?(d.onmessage=c,d.postMessage(s)):c({data:t.workerMethods.run(s)}))},startRendering:function(e){this.onRenderCompleteCallback=e;for(var t=0;t<this.options.numWorkers&&t<this.frames.length;t++)this.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<this.frames.length;t++){var r=this.frames[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&this.processFrame(e)},generateGIF:function(e,t){var r=[],i={loop:this.repeat},n=this.options,o=n.interval,a=n.frameDuration,d=!!n.images.length,c=n.gifHeight,l=n.gifWidth,u=new s(r,l,c,i),m=this.onRenderProgressCallback,f=d?100*o:0,g=void 0;this.generatingGIF=!0,h.each(e,function(t,r){var i=r.palette;m(.75+.25*r.position*1/e.length);for(var n=0;n<a;n++)u.addFrame(0,0,l,c,r.pixels,{palette:i,delay:f})}),u.end(),m(1),this.frames=[],this.generatingGIF=!1,h.isFunction(t)&&(g=this.bufferToString(r),t("data:image/gif;base64,"+h.btoa(g)))},setRepeat:function(e){this.repeat=e},addFrame:function(e,t){t=h.isObject(t)?t:{};var r=this,i=r.ctx,n=r.options,o=n.gifWidth,a=n.gifHeight,s=h.getFontSize(t),d=t,c=d.fontColor,l=d.fontFamily,u=d.fontWeight,m=(d.gifHeight,d.gifWidth,d.text),f=d.textAlign,g=d.textBaseline,p=t.textXCoordinate?t.textXCoordinate:"left"===f?1:"right"===f?o:o/2,v=t.textYCoordinate?t.textYCoordinate:"top"===g?1:"center"===g?a/2:a,b=u+" "+s+" "+l,w=void 0;try{i.drawImage(e,0,0,o,a),m&&(i.font=b,i.fillStyle=c,i.textAlign=f,i.textBaseline=g,i.fillText(m,p,v)),w=i.getImageData(0,0,o,a),r.addFrameImageData(w)}catch(e){return""+e}},addFrameImageData:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=this.frames,r=e.data;this.frames.push({data:r,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){this.onRenderProgressCallback=e},isRendering:function(){return this.generatingGIF},getBase64GIF:function(e){var t=this;t.startRendering(function(r){t.destroyWorkers(),h.requestTimeout(function(){e(r)},0)})},destroyWorkers:function(){if(!this.workerError){var e=this.workers;h.each(e,function(e,t){var r=t.worker,i=t.objectUrl;r.terminate(),h.URL.revokeObjectURL(i)})}}};var x=function(){},F={getGIF:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=arguments[1];r=h.isFunction(r)?r:x;var n=t.createElement("canvas"),o=void 0,a=!!e.images.length,s=e.cameraStream,d=e.crop,c=e.fontColor,l=e.fontFamily,u=e.fontWeight,m=e.keepCameraOn,f=(e.numWorkers,e.progressCallback),g=e.saveRenderingContexts,p=e.savedRenderingContexts,v=e.text,b=e.textAlign,w=e.textBaseline,y=e.videoElement,C=e.videoHeight,S=e.videoWidth,F=e.webcamVideoElement,W=Number(e.gifWidth),E=Number(e.gifHeight),O=Number(e.interval),A=(Number(e.sampleInterval),a?0:1e3*O),U=[],R=p.length?p.length:e.numFrames,M=R,T=new k(e),I=h.getFontSize(e),V=e.textXCoordinate?e.textXCoordinate:"left"===b?1:"right"===b?W:W/2,j=e.textYCoordinate?e.textYCoordinate:"top"===w?1:"center"===w?E/2:E,z=u+" "+I+" "+l,H=d?Math.floor(d.scaledWidth/2):0,L=d?S-d.scaledWidth:0,B=d?Math.floor(d.scaledHeight/2):0,P=d?C-d.scaledHeight:0,G=function e(){function t(){try{L>S&&(L=S),P>C&&(P=C),H<0&&(H=0),B<0&&(B=0),o.drawImage(y,H,B,L,P,0,0,W,E),i()}catch(e){if("NS_ERROR_NOT_AVAILABLE"!==e.name)throw e;h.requestTimeout(t,100)}}function i(){var t=void 0;g&&U.push(o.getImageData(0,0,W,E)),v&&(o.font=z,o.fillStyle=c,o.textAlign=b,o.textBaseline=w,o.fillText(v,V,j)),t=o.getImageData(0,0,W,E),T.addFrameImageData(t),f((R-(M=n))/R),n>0&&h.requestTimeout(e,A),M||T.getBase64GIF(function(e){r({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:s,videoElement:y,webcamVideoElement:F,savedRenderingContexts:U,keepCameraOn:m})})}var n=M-1;p.length?(o.putImageData(p[R-M],0,0),i()):t()};R=R!==i?R:10,O=O!==i?O:.1,n.width=W,n.height=E,o=n.getContext("2d"),function e(){p.length||0!==y.currentTime?G():h.requestTimeout(e,100)}()},getCropDimensions:function(){var e=arguments.length>0&&arguments[0]!==i?arguments[0]:{},t=e.videoWidth,r=e.videoHeight,n=e.gifWidth,o=e.gifHeight,a={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(a.width=Math.round(t*(o/r))-n,a.scaledWidth=Math.round(a.width*(r/o))):(a.height=Math.round(r*(n/t))-o,a.scaledHeight=Math.round(a.height*(t/n))),a}},W={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function e(t){e.attempts=e.attempts||0;var r=t.cameraStream,i=t.completedCallback,n=t.videoElement;n&&(n.videoWidth>0&&n.videoHeight>0?(n.removeEventListener("loadeddata",W.findVideoSize),i({videoElement:n,cameraStream:r,videoWidth:n.videoWidth,videoHeight:n.videoHeight})):e.attempts<10?(e.attempts+=1,h.requestTimeout(function(){W.findVideoSize(t)},200)):i({videoElement:n,cameraStream:r,videoWidth:W.defaultVideoDimensions.width,videoHeight:W.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){h.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=h.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,r=e.cameraStream,i=e.completedCallback,n=e.streamedCallback,o=e.videoElement;h.isFunction(n)&&n(),t?h.isString(t)?(o.src=t,o.innerHTML='<source src="'+t+'" type="video/'+h.getExtension(t)+'" />'):t instanceof Blob&&(o.src=h.URL.createObjectURL(t),o.innerHTML='<source src="'+t+'" type="'+t.type+'" />'):o.mozSrcObject?o.mozSrcObject=r:h.URL&&(o.src=h.URL.createObjectURL(r)),o.play(),h.requestTimeout(function(){h.requestTimeout(function e(){e.count=e.count||0,!0===W.loadedData?(W.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}),W.loadedData=!1):(e.count+=1)>10?W.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}):e()},100)},400)},startStreaming:function(e){var r=h.isFunction(e.error)?e.error:h.noop,i=h.isFunction(e.streamed)?e.streamed:h.noop,n=h.isFunction(e.completed)?e.completed:h.noop,o=e.crossOrigin,a=e.existingVideo,s=e.lastCameraStream,d=e.options,c=e.webcamVideoElement,l=h.isElement(a)?a:c||t.createElement("video");o&&(l.crossOrigin=d.crossOrigin),l.autoplay=!0,l.loop=!0,l.muted=!0,l.addEventListener("loadeddata",function(e){W.loadedData=!0}),a?W.stream({videoElement:l,existingVideo:a,completedCallback:n}):s?W.stream({videoElement:l,cameraStream:s,streamedCallback:i,completedCallback:n}):h.getUserMedia({video:!0},function(e){W.stream({videoElement:l,cameraStream:e,streamedCallback:i,completedCallback:n})},r)},startVideoStreaming:function(e){var t=arguments.length>1&&arguments[1]!==i?arguments[1]:{},r=t.timeout!==i?t.timeout:0,n=t.callback,o=t.webcamVideoElement,a=void 0;r>0&&(a=h.requestTimeout(function(){W.onStreamingTimeout(n)},1e4)),W.startStreaming({error:function(){n({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(a)},completed:function(){var t=arguments.length>0&&arguments[0]!==i?arguments[0]:{},r=t.cameraStream,n=t.videoElement,o=t.videoHeight,a=t.videoWidth;e({cameraStream:r,videoElement:n,videoHeight:o,videoWidth:a})},lastCameraStream:t.lastCameraStream,webcamVideoElement:o,crossOrigin:t.crossOrigin,options:t})},stopVideoStreaming:function(e){var t=e=h.isObject(e)?e:{},r=t.keepCameraOn,i=t.videoElement,n=t.webcamVideoElement,o=e.cameraStream||{},a=o.getTracks?o.getTracks()||[]:[],s=!!a.length,d=a[0];!r&&s&&h.isFunction(d.stop)&&d.stop(),h.isElement(i)&&!n&&(i.pause(),h.isFunction(h.URL.revokeObjectURL)&&!h.webWorkerError&&i.src&&h.URL.revokeObjectURL(i.src),h.removeElement(i))}},E={utils:p,error:b,defaultOptions:C,createGIF:g,takeSnapShot:function(e,t){if(t=h.isFunction(e)?e:t,e=h.isObject(e)?e:{},h.isFunction(t)){var r=h.mergeOptions(y,e);g(h.mergeOptions(r,{interval:.1,numFrames:1,gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)}),t)}},stopVideoStreaming:l,isSupported:function(){return v.isValid()},isWebCamGIFSupported:n,isExistingVideoGIFSupported:function(e){var t=!1;if(h.isArray(e)&&e.length){if(h.each(e,function(e,r){h.isSupported.videoCodecs[r]&&(t=!0)}),!t)return!1}else if(h.isString(e)&&e.length&&!h.isSupported.videoCodecs[e])return!1;return v.isValid({getUserMedia:!0})},isExistingImagesGIFSupported:function(){var e={getUserMedia:!0};return v.isValid(e)},VERSION:"0.4.1"};"function"==typeof define&&define.amd?define([],function(){return E}):"undefined"!=typeof exports?module.exports=E:e.gifshot=E}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{});
