/*Copyrights for code authored by Yahoo Inc. is licensed under the following terms:
MIT License
Copyright  2017 Yahoo Inc.
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
!function(){"use strict";function e(){return p.isValid()}function t(){return p.isValid()}function r(){var e={getUserMedia:!0};return p.isValid(e)}function i(e){var t=!1;if(v.isArray(e)&&e.length){if(v.each(e,function(e,r){v.isSupported.videoCodecs[r]&&(t=!0)}),!t)return!1}else if(v.isString(e)&&e.length&&!v.isSupported.videoCodecs[e])return!1;return p.isValid({getUserMedia:!0})}function n(){function e(e,t,r){var i,n;for(l=e,m=t,g=r,f=new Array(v),i=0;v>i;i++)f[i]=new Array(4),n=f[i],n[0]=n[1]=n[2]=(i<<S+8)/v|0,D[i]=x/v|0,G[i]=0}function t(){for(var e=[],t=new Array(v),r=0;v>r;r++)t[f[r][3]]=r;for(var i=0,n=0;v>n;n++){var o=t[n];e[i++]=f[o][0],e[i++]=f[o][1],e[i++]=f[o][2]}return e}function r(){var e,t,r,i,n,o,a,s;for(a=0,s=0,e=0;v>e;e++){for(n=f[e],r=e,i=n[1],t=e+1;v>t;t++)o=f[t],o[1]<i&&(r=t,i=o[1]);if(o=f[r],e!=r&&(t=o[0],o[0]=n[0],n[0]=t,t=o[1],o[1]=n[1],n[1]=t,t=o[2],o[2]=n[2],n[2]=t,t=o[3],o[3]=n[3],n[3]=t),i!=a){for(B[a]=s+e>>1,t=a+1;i>t;t++)B[t]=e;a=i,s=e}}for(B[a]=s+C>>1,t=a+1;256>t;t++)B[t]=C}function i(){var e,t,r,i,n,o,a,f,v,C,F,x,W,E;for(y>m&&(g=1),u=30+(g-1)/3,x=l,W=0,E=m,F=m/(3*g),C=F/k|0,f=j,o=I,a=o>>R,1>=a&&(a=0),e=0;a>e;e++)N[e]=f*((a*a-e*e)*H/(a*a));for(v=y>m?3:m%h!==0?3*h:m%p!==0?3*p:m%b!==0?3*b:3*w,e=0;F>e;)if(r=(255&x[W+0])<<S,i=(255&x[W+1])<<S,n=(255&x[W+2])<<S,t=c(r,i,n),d(f,t,r,i,n),0!==a&&s(a,t,r,i,n),W+=v,W>=E&&(W-=m),e++,0===C&&(C=1),e%C===0)for(f-=f/u,o-=o/T,a=o>>R,1>=a&&(a=0),t=0;a>t;t++)N[t]=f*((a*a-t*t)*H/(a*a))}function n(e,t,r){var i,n,o,a,s,d,c;for(s=1e3,c=-1,i=B[t],n=i-1;v>i||n>=0;)v>i&&(d=f[i],o=d[1]-t,o>=s?i=v:(i++,0>o&&(o=-o),a=d[0]-e,0>a&&(a=-a),o+=a,s>o&&(a=d[2]-r,0>a&&(a=-a),o+=a,s>o&&(s=o,c=d[3])))),n>=0&&(d=f[n],o=t-d[1],o>=s?n=-1:(n--,0>o&&(o=-o),a=d[0]-e,0>a&&(a=-a),o+=a,s>o&&(a=d[2]-r,0>a&&(a=-a),o+=a,s>o&&(s=o,c=d[3]))));return c}function o(){return i(),a(),r(),t()}function a(){var e;for(e=0;v>e;e++)f[e][0]>>=S,f[e][1]>>=S,f[e][2]>>=S,f[e][3]=e}function s(e,t,r,i,n){var o,a,s,d,c,u,l;for(s=t-e,-1>s&&(s=-1),d=t+e,d>v&&(d=v),o=t+1,a=t-1,u=1;d>o||a>s;){if(c=N[u++],d>o){l=f[o++];try{l[0]-=c*(l[0]-r)/P|0,l[1]-=c*(l[1]-i)/P|0,l[2]-=c*(l[2]-n)/P|0}catch(m){}}if(a>s){l=f[a--];try{l[0]-=c*(l[0]-r)/P|0,l[1]-=c*(l[1]-i)/P|0,l[2]-=c*(l[2]-n)/P|0}catch(m){}}}}function d(e,t,r,i,n){var o=f[t],a=e/j;o[0]-=a*(o[0]-r)|0,o[1]-=a*(o[1]-i)|0,o[2]-=a*(o[2]-n)|0}function c(e,t,r){var i,n,o,a,s,d,c,u,l,m;for(u=~(1<<31),l=u,d=-1,c=d,i=0;v>i;i++)m=f[i],n=m[0]-e,0>n&&(n=-n),o=m[1]-t,0>o&&(o=-o),n+=o,o=m[2]-r,0>o&&(o=-o),n+=o,u>n&&(u=n,d=i),a=n-(G[i]>>F-S),l>a&&(l=a,c=i),s=D[i]>>E,D[i]-=s,G[i]+=s<<W;return D[d]+=O,G[d]-=A,c}var u,l,m,g,f,v=256,h=499,p=491,b=487,w=503,y=3*w,C=v-1,S=4,k=100,F=16,x=1<<F,W=10,E=10,O=x>>E,A=x<<W-E,U=v>>3,R=6,M=1<<R,I=U*M,T=30,V=10,j=1<<V,z=8,H=1<<z,L=V+z,P=1<<L,B=[],G=[],D=[],N=[];e.apply(this,arguments);var q={};return q.map=n,q.process=o,q}function o(){var e=this,t=this;try{t.onmessage=function(e){var t,r=e.data||{};r.gifshot&&(t=i.run(r),postMessage(t))}}catch(r){}var i={dataToRGB:function(e,t,r){for(var i=t*r*4,n=0,o=[];i>n;)o.push(e[n++]),o.push(e[n++]),o.push(e[n++]),n++;return o},componentizedPaletteToArray:function(e){var t=[],r=void 0,i=void 0,n=void 0,o=void 0;for(r=0;r<e.length;r+=3)i=e[r],n=e[r+1],o=e[r+2],t.push(i<<16|n<<8|o);return t},processFrameWithQuantizer:function(t,r,i,o){var a=e.dataToRGB(t,r,i),s=new n(a,a.length,o),d=s.process(),c=new Uint32Array(e.componentizedPaletteToArray(d)),u=r*i,l=new Uint8Array(u),m=0,g=void 0,f=void 0,v=void 0,h=void 0;for(g=0;u>g;g++)f=a[m++],v=a[m++],h=a[m++],l[g]=s.map(f,v,h);return{pixels:l,palette:c}},run:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.height,i=(t.palette,t.sampleInterval),n=t.width,o=t.data;return e.processFrameWithQuantizer(o,n,r,i)}};return i}function a(e,t,r,i){function n(e){var t=e.length;if(2>t||t>256||t&t-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return t}function o(e,t,r,i){function n(r){for(;m>=r;)e[t++]=255&g,g>>=8,m-=8,t===a+256&&(e[a]=255,a=t++)}function o(e){g|=e<<m,m+=l,n(8)}e[t++]=r;var a=t++,s=1<<r,d=s-1,c=s+1,u=c+1,l=r+1,m=0,g=0,f=i[0]&d,v={};o(s);for(var h=1,p=i.length;p>h;++h){var b=i[h]&d,w=f<<8|b,y=v[w];if(void 0===y){for(g|=f<<m,m+=l;m>=8;)e[t++]=255&g,g>>=8,m-=8,t===a+256&&(e[a]=255,a=t++);4096===u?(o(s),u=c+1,l=r+1,v={}):(u>=1<<l&&++l,v[w]=u++),f=b}else f=y}return o(f),o(c),n(1),a+1===t?e[a]=0:(e[a]=t-a-1,e[t++]=0),t}var a=0;i=void 0===i?{}:i;var s=void 0===i.loop?null:i.loop,d=void 0===i.palette?null:i.palette;if(0>=t||0>=r||t>65535||r>65535)throw"Width/Height invalid.";e[a++]=71,e[a++]=73,e[a++]=70,e[a++]=56,e[a++]=57,e[a++]=97;var c=0,u=0;if(e[a++]=255&t,e[a++]=t>>8&255,e[a++]=255&r,e[a++]=r>>8&255,e[a++]=(null!==d?128:0)|c,e[a++]=u,e[a++]=0,null!==s){if(0>s||s>65535)throw"Loop count invalid.";e[a++]=33,e[a++]=255,e[a++]=11,e[a++]=78,e[a++]=69,e[a++]=84,e[a++]=83,e[a++]=67,e[a++]=65,e[a++]=80,e[a++]=69,e[a++]=50,e[a++]=46,e[a++]=48,e[a++]=3,e[a++]=1,e[a++]=255&s,e[a++]=s>>8&255,e[a++]=0}var l=!1;this.addFrame=function(t,r,i,s,c,u){if(l===!0&&(--a,l=!1),u=void 0===u?{}:u,0>t||0>r||t>65535||r>65535)throw"x/y invalid.";if(0>=i||0>=s||i>65535||s>65535)throw"Width/Height invalid.";if(c.length<i*s)throw"Not enough pixels for the frame size.";var m=!0,g=u.palette;if((void 0===g||null===g)&&(m=!1,g=d),void 0===g||null===g)throw"Must supply either a local or global palette.";for(var f=n(g),v=0;f>>=1;)++v;f=1<<v;var h=void 0===u.delay?0:u.delay,p=void 0===u.disposal?0:u.disposal;if(0>p||p>3)throw"Disposal out of range.";var b=!1,w=0;if(void 0!==u.transparent&&null!==u.transparent&&(b=!0,w=u.transparent,0>w||w>=f))throw"Transparent color index.";if((0!==p||b||0!==h)&&(e[a++]=33,e[a++]=249,e[a++]=4,e[a++]=p<<2|(b===!0?1:0),e[a++]=255&h,e[a++]=h>>8&255,e[a++]=w,e[a++]=0),e[a++]=44,e[a++]=255&t,e[a++]=t>>8&255,e[a++]=255&r,e[a++]=r>>8&255,e[a++]=255&i,e[a++]=i>>8&255,e[a++]=255&s,e[a++]=s>>8&255,e[a++]=m===!0?128|v-1:0,m===!0)for(var y=0,C=g.length;C>y;++y){var S=g[y];e[a++]=S>>16&255,e[a++]=S>>8&255,e[a++]=255&S}a=o(e,a,2>v?2:v,c)},this.end=function(){return l===!1&&(e[a++]=59,l=!0),a}}function s(e,t){e.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e})})}function d(){function e(){v.each(c,function(e,t){t&&m.addFrame(t,o)}),s(m,n)}var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.images,i=t.imagesLength,n=t.callback,o=t.options,a={getUserMedia:!0,"window.URL":!0},d=p.validate(a),c=[],u=0,l=void 0,m=void 0;return d.error?n(d):(m=new F(o),v.each(r,function(t,r){v.isElement(r)?(o.crossOrigin&&(r.crossOrigin=o.crossOrigin),c[t]=r,u+=1,u===i&&e()):v.isString(r)&&(l=document.createElement("img"),o.crossOrigin&&(l.crossOrigin=o.crossOrigin),l.onerror=function(){c.length>t&&(c[t]=void 0)},function(r){r.onload=function(){c[t]=r,u+=1,u===i&&e(),v.removeElement(r)}}(l),l.src=r,v.setCSSAttr(l,{position:"fixed",opacity:"0"}),document.body.appendChild(l))}),void 0)}function c(e){e=v.isObject(e)?e:{},E.stopVideoStreaming(e)}function u(e,t){var r=e.options||{},i=r.images,n=r.video,o=Number(r.gifWidth),a=Number(r.gifHeight),s=(Number(r.numFrames),e.cameraStream),d=e.videoElement,u=e.videoWidth,l=e.videoHeight,m=W.getCropDimensions({videoWidth:u,videoHeight:l,gifHeight:a,gifWidth:o}),g=t;r.crop=m,r.videoElement=d,r.videoWidth=u,r.videoHeight=l,r.cameraStream=s,v.isElement(d)&&(d.width=o+m.width,d.height=a+m.height,r.webcamVideoElement||(v.setCSSAttr(d,{position:"fixed",opacity:"0"}),document.body.appendChild(d)),d.play(),W.getGIF(r,function(e){i&&i.length||n&&n.length||c(e),g(e)}))}function l(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.callback,r=e.existingVideo,i=e.options,n={getUserMedia:!0,"window.URL":!0},o=p.validate(n),a=void 0,s=void 0;if(o.error)return t(o);if(v.isElement(r)&&r.src){if(s=r.src,a=v.getExtension(s),!v.isSupported.videoCodecs[a])return t(p.messages.videoCodecs)}else v.isArray(r)&&v.each(r,function(e,t){return a=t.substr(t.lastIndexOf(".")+1,t.length),v.isSupported.videoCodecs[a]?(r=t,!1):void 0});E.startStreaming({completed:function(e){e.options=i||{},u(e,t)},existingVideo:r,crossOrigin:i.crossOrigin,options:i})}function m(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.callback,i=e.lastCameraStream,n=e.options,o=e.webcamVideoElement;return t()?n.savedRenderingContexts.length?(W.getWebcamGIF(n,function(e){r(e)}),void 0):(E.startVideoStreaming(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.options=n||{},u(e,r)},{lastCameraStream:i,callback:r,webcamVideoElement:o,crossOrigin:n.crossOrigin}),void 0):r(p.validate())}function g(e,t){if(t=v.isFunction(e)?e:t,e=v.isObject(e)?e:{},v.isFunction(t)){var r=v.mergeOptions(y,e)||{},i=e.cameraStream,n=r.images,o=n?n.length:0,a=r.video,s=r.webcamVideoElement;r=v.mergeOptions(r,{gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)}),o?d({images:n,imagesLength:o,callback:t,options:r}):a?l({existingVideo:a,callback:t,options:r}):m({lastCameraStream:i,callback:t,webcamVideoElement:s,options:r})}}function f(e,t){if(t=v.isFunction(e)?e:t,e=v.isObject(e)?e:{},v.isFunction(t)){var r=v.mergeOptions(y,e),i=v.mergeOptions(r,{interval:.1,numFrames:1,gifWidth:Math.floor(r.gifWidth),gifHeight:Math.floor(r.gifHeight)});g(i,t)}}var v={URL:window.URL||window.webkitURL||window.mozURL||window.msURL,getUserMedia:function(){var e=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return e?e.bind(navigator):e}(),requestAnimFrame:window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,requestTimeout:function(e,t){if(e=e||v.noop,t=t||0,!v.requestAnimFrame)return setTimeout(e,t);var r=(new Date).getTime(),i=new Object,n=v.requestAnimFrame,o=function a(){var o=(new Date).getTime(),s=o-r;s>=t?e.call():i.value=n(a)};return i.value=n(o),i},Blob:window.Blob||window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,btoaFallback:function(e){for(var t="",r=0,i=e.length,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,a=void 0,s=void 0,d=void 0,c=void 0,u=void 0,l=void 0;i>r;)o=e.charCodeAt(r++),a=e.charCodeAt(r++),s=e.charCodeAt(r++),d=o>>2,c=(3&o)<<4|a>>4,u=(15&a)<<2|s>>6,l=63&s,isNaN(a)?u=l=64:isNaN(s)&&(l=64),t=t+n.charAt(d)+n.charAt(c)+n.charAt(u)+n.charAt(l);return t},btoa:function(){var e=window.btoa||v.btoaFallback;return e?e.bind(window):v.noop}(),isObject:function(e){return e&&"[object Object]"===Object.prototype.toString.call(e)},isEmptyObject:function(e){return v.isObject(e)&&!Object.keys(e).length},isArray:function(e){return e&&Array.isArray(e)},isFunction:function(e){return e&&"function"==typeof e},isElement:function(e){return e&&1===e.nodeType},isString:function(e){return"string"==typeof e||"[object String]"===Object.prototype.toString.call(e)},isSupported:{canvas:function(){var e=document.createElement("canvas");return e&&e.getContext&&e.getContext("2d")},webworkers:function(){return window.Worker},blob:function(){return v.Blob},Uint8Array:function(){return window.Uint8Array},Uint32Array:function(){return window.Uint32Array},videoCodecs:function(){var e=document.createElement("video"),t={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{e&&e.canPlayType&&(t.mp4=""!==e.canPlayType('video/mp4; codecs="mp4v.20.8"'),t.h264=""!==(e.canPlayType('video/mp4; codecs="avc1.42E01E"')||e.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),t.ogv=""!==e.canPlayType('video/ogg; codecs="theora"'),t.ogg=""!==e.canPlayType('video/ogg; codecs="theora"'),t.webm=-1!==e.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(r){}return t}()},noop:function(){},each:function(e,t){var r=void 0,i=void 0;if(v.isArray(e))for(r=-1,i=e.length;++r<i&&t(r,e[r])!==!1;);else if(v.isObject(e))for(r in e)if(e.hasOwnProperty(r)&&t(r,e[r])===!1)break},mergeOptions:function(e,t){if(v.isObject(e)&&v.isObject(t)&&Object.keys){var r={};return v.each(e,function(t){r[t]=e[t]}),v.each(t,function(i){var n=t[i];r[i]=v.isObject(n)?e[i]?v.mergeOptions(e[i],n):n:n}),r}},setCSSAttr:function(e,t,r){v.isElement(e)&&(v.isString(t)&&v.isString(r)?e.style[t]=r:v.isObject(t)&&v.each(t,function(t,r){e.style[t]=r}))},removeElement:function(e){v.isElement(e)&&e.parentNode&&e.parentNode.removeChild(e)},createWebWorker:function(e){if(!v.isString(e))return{};try{var t=new v.Blob([e],{type:"text/javascript"}),r=v.URL.createObjectURL(t),i=new Worker(r);return{objectUrl:r,worker:i}}catch(n){return""+n}},getExtension:function(e){return e.substr(e.lastIndexOf(".")+1,e.length)},getFontSize:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!document.body||e.resizeFont===!1)return e.fontSize;var t=e.text,r=e.gifWidth,i=parseInt(e.fontSize,10),n=parseInt(e.minFontSize,10),o=document.createElement("div"),a=document.createElement("span");for(o.setAttribute("width",r),o.appendChild(a),a.innerHTML=t,a.style.fontSize=i+"px",a.style.textIndent="-9999px",a.style.visibility="hidden",document.body.appendChild(a);a.offsetWidth>r&&i>=n;)a.style.fontSize=--i+"px";return document.body.removeChild(a),i+"px"},webWorkerError:!1},h=Object.freeze({"default":v}),p={validate:function(e){e=v.isObject(e)?e:{};var t={};return v.each(p.validators,function(r,i){var n=i.errorCode;return e[n]||i.condition?void 0:(t=i,t.error=!0,!1)}),delete t.condition,t},isValid:function A(e){var t=p.validate(e),A=t.error!==!0?!0:!1;return A},validators:[{condition:v.isFunction(v.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:v.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:v.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:v.isFunction(v.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:v.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:v.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:v.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},b=Object.freeze({"default":p}),w=function(){},y={sampleInterval:10,numWorkers:2,gifWidth:200,gifHeight:200,interval:.1,numFrames:10,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:w,completeCallback:w,saveRenderingContexts:!1,savedRenderingContexts:[],crossOrigin:"Anonymous"},C=Object.freeze({"default":y}),S=void 0,k=function(){},F=function(e){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=k,this.onRenderProgressCallback=k,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=e,this.initializeWebWorkers(e)};F.prototype={workerMethods:o(),initializeWebWorkers:function(e){var t=S,r=n.toString()+"("+o.toString()+"());",i=void 0,a=void 0,s=void 0,d=void 0,c=-1,u="";for(d=e.numWorkers;++c<d;)i=v.createWebWorker(r),v.isObject(i)?(a=i.objectUrl,s=i.worker,t.workers.push({worker:s,objectUrl:a}),t.availableWorkers.push(s)):(u=i,v.webWorkerError=!!i);S.workerError=u,S.canvas=document.createElement("canvas"),S.canvas.width=e.gifWidth,S.canvas.height=e.gifHeight,S.ctx=S.canvas.getContext("2d"),S.frames=[]},getWorker:function(){return S.availableWorkers.pop()},freeWorker:function(e){S.availableWorkers.push(e)},byteMap:function(){for(var e=[],t=0;256>t;t++)e[t]=String.fromCharCode(t);return e}(),bufferToString:function(e){for(var t=e.length,r="",i=-1;++i<t;)r+=S.byteMap[e[i]];return r},onFrameFinished:function(e){var t=S,r=t.frames,i=t.options,n=!!(i.images||[]).length,o=r.every(function(e){return!e.beingProcessed&&e.done});t.numRenderedFrames++,n&&e(t.numRenderedFrames/r.length),t.onRenderProgressCallback(.75*t.numRenderedFrames/r.length),o?t.generatingGIF||t.generateGIF(r,t.onRenderCompleteCallback):v.requestTimeout(function(){t.processNextFrame()},1)},processFrame:function(e){var t=S,r=(S.options,S.options),i=r.progressCallback,n=r.sampleInterval,o=S.frames,a=void 0,s=void 0,d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.data;delete a.data,a.pixels=Array.prototype.slice.call(r.pixels),a.palette=Array.prototype.slice.call(r.palette),a.done=!0,a.beingProcessed=!1,t.freeWorker(s),t.onFrameFinished(i)};return a=o[e],a.beingProcessed||a.done?(S.onFrameFinished(),void 0):(a.sampleInterval=n,a.beingProcessed=!0,a.gifshot=!0,s=S.getWorker(),s?(s.onmessage=d,s.postMessage(a)):d({data:t.workerMethods.run(a)}),void 0)},startRendering:function(e){S.onRenderCompleteCallback=e;for(var t=0;t<S.options.numWorkers&&t<S.frames.length;t++)S.processFrame(t)},processNextFrame:function(){for(var e=-1,t=0;t<S.frames.length;t++){var r=S.frames[t];if(!r.done&&!r.beingProcessed){e=t;break}}e>=0&&S.processFrame(e)},generateGIF:function(e,t){var r=[],i={loop:S.repeat},n=S.options,o=(n.images,n.interval),s=!!existingImages.length,d=n.gifHeight,c=n.gifWidth,u=new a(r,c,d,i),l=S.onRenderProgressCallback,m=s?100*o:0,g=void 0,f=void 0;S.generatingGIF=!0,v.each(e,function(t,r){var i=r.palette;l(.75+.25*r.position*1/e.length),u.addFrame(0,0,c,d,r.pixels,{palette:i,delay:m})}),u.end(),l(1),S.frames=[],S.generatingGIF=!1,v.isFunction(t)&&(g=S.bufferToString(r),f="data:image/gif;base64,"+v.btoa(g),t(f))},setRepeat:function(e){S.repeat=e},addFrame:function(e,t){t=v.isObject(t)?t:{};var r=S,i=r.ctx,n=r.options,o=n.gifWidth,a=n.gifHeight,s=v.getFontSize(t),d=t,c=d.fontColor,u=d.fontFamily,l=d.fontWeight,m=(d.gifHeight,d.gifWidth,d.text),g=d.textAlign,f=d.textBaseline,h=t.textXCoordinate?t.textXCoordinate:"left"===g?1:"right"===g?o:o/2,p=t.textYCoordinate?t.textYCoordinate:"top"===f?1:"center"===f?a/2:a,b=l+" "+s+" "+u,w=void 0;try{i.drawImage(e,0,0,o,a),m&&(i.font=b,i.fillStyle=c,i.textAlign=g,i.textBaseline=f,i.fillText(m,h,p)),w=i.getImageData(0,0,o,a),r.addFrameImageData(w)}catch(y){return""+y}},addFrameImageData:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=S.frames,r=e.data;S.frames.push({data:r,width:e.width,height:e.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:t.length})},onRenderProgress:function(e){S.onRenderProgressCallback=e},isRendering:function(){return S.generatingGIF},getBase64GIF:function(e){var t=S,r=function(r){t.destroyWorkers(),v.requestTimeout(function(){e(r)},0)};t.startRendering(r)},destroyWorkers:function(){if(!S.workerError){var e=S.workers;v.each(e,function(e,t){var r=t.worker,i=t.objectUrl;r.terminate(),v.URL.revokeObjectURL(i)})}}};var x=function(){},W={getGIF:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];t=v.isFunction(t)?t:x;var r=document.createElement("canvas"),i=void 0,n=e.images,o=!!n.length,a=e.cameraStream,s=e.crop,d=e.fontColor,c=e.fontFamily,u=e.fontWeight,l=e.keepCameraOn,m=(e.numWorkers,e.progressCallback),g=e.saveRenderingContexts,f=e.savedRenderingContexts,h=e.text,p=e.textAlign,b=e.textBaseline,w=e.videoElement,y=e.videoHeight,C=e.videoWidth,S=e.webcamVideoElement,k=Number(e.gifWidth),W=Number(e.gifHeight),E=Number(e.interval),O=(Number(e.sampleInterval),o?0:1e3*E),A=[],U=f.length?f.length:e.numFrames,R=U,M=new F(e),I=v.getFontSize(e),T=e.textXCoordinate?e.textXCoordinate:"left"===p?1:"right"===p?k:k/2,V=e.textYCoordinate?e.textYCoordinate:"top"===b?1:"center"===b?W/2:W,j=u+" "+I+" "+c,z=s?Math.floor(s.scaledWidth/2):0,H=s?C-s.scaledWidth:0,L=s?Math.floor(s.scaledHeight/2):0,P=s?y-s.scaledHeight:0,B=function(){function e(){try{H>C&&(H=C),P>y&&(P=y),0>z&&(z=0),0>L&&(L=0),i.drawImage(w,z,L,H,P,0,0,k,W),r()}catch(t){if("NS_ERROR_NOT_AVAILABLE"!==t.name)throw t;v.requestTimeout(e,100)}}function r(){var e=void 0;g&&A.push(i.getImageData(0,0,k,W)),h&&(i.font=j,i.fillStyle=d,i.textAlign=p,i.textBaseline=b,i.fillText(h,T,V)),e=i.getImageData(0,0,k,W),M.addFrameImageData(e),R=n,m((U-R)/U),n>0&&v.requestTimeout(captureFrame,O),R||M.getBase64GIF(function(e){t({error:!1,errorCode:"",errorMsg:"",image:e,cameraStream:a,videoElement:w,webcamVideoElement:S,savedRenderingContexts:A,keepCameraOn:l})})}var n=R-1;f.length?(i.putImageData(f[U-R],0,0),r()):e()};U=void 0!==U?U:10,E=void 0!==E?E:.1,r.width=k,r.height=W,i=r.getContext("2d"),function G(){return f.length||0!==w.currentTime?(B(),void 0):(v.requestTimeout(G,100),void 0)}()},getCropDimensions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.videoWidth,r=e.videoHeight,i=e.gifWidth,n=e.gifHeight,o={width:0,height:0,scaledWidth:0,scaledHeight:0};return t>r?(o.width=Math.round(t*(n/r))-i,o.scaledWidth=Math.round(o.width*(r/n))):(o.height=Math.round(r*(i/t))-n,o.scaledHeight=Math.round(o.height*(t/i))),o}},E={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function U(e){U.attempts=U.attempts||0;var t=e.cameraStream,r=e.completedCallback,i=e.videoElement;i&&(i.videoWidth>0&&i.videoHeight>0?(i.removeEventListener("loadeddata",E.findVideoSize),r({videoElement:i,cameraStream:t,videoWidth:i.videoWidth,videoHeight:i.videoHeight})):U.attempts<10?(U.attempts+=1,v.requestTimeout(function(){E.findVideoSize(e)},200)):r({videoElement:i,cameraStream:t,videoWidth:E.defaultVideoDimensions.width,videoHeight:E.defaultVideoDimensions.height}))},onStreamingTimeout:function(e){v.isFunction(e)&&e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(e){var t=v.isArray(e.existingVideo)?e.existingVideo[0]:e.existingVideo,r=e.cameraStream,i=e.completedCallback,n=e.streamedCallback,o=e.videoElement;v.isFunction(n)&&n(),t?v.isString(t)&&(o.src=t,o.innerHTML='<source src="'+t+'" type="video/'+v.getExtension(t)+'" />'):o.mozSrcObject?o.mozSrcObject=r:v.URL&&(o.src=v.URL.createObjectURL(r)),o.play(),v.requestTimeout(function a(){a.count=a.count||0,E.loadedData===!0?(E.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}),E.loadedData=!1):(a.count+=1,a.count>10?E.findVideoSize({videoElement:o,cameraStream:r,completedCallback:i}):a())},100)},startStreaming:function(e){var t=v.isFunction(e.error)?e.error:v.noop,r=v.isFunction(e.streamed)?e.streamed:v.noop,i=v.isFunction(e.completed)?e.completed:v.noop,n=e.crossOrigin,o=e.existingVideo,a=e.lastCameraStream,s=e.options,d=e.webcamVideoElement,c=v.isElement(o)?o:d?d:document.createElement("video");n&&(c.crossOrigin=s.crossOrigin),c.autoplay=!0,c.loop=!0,c.muted=!0,c.addEventListener("loadeddata",function(){E.loadedData=!0}),o?E.stream({videoElement:c,existingVideo:o,completedCallback:i}):a?E.stream({videoElement:c,cameraStream:a,streamedCallback:r,completedCallback:i}):v.getUserMedia({video:!0},function(e){E.stream({videoElement:c,cameraStream:e,streamedCallback:r,completedCallback:i})},t)},startVideoStreaming:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=void 0!==t.timeout?t.timeout:0,i=t.callback,n=t.webcamVideoElement,o=void 0;r>0&&(o=v.requestTimeout(function(){E.onStreamingTimeout(i)},1e4)),E.startStreaming({error:function(){i({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(o)},completed:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.cameraStream,i=t.videoElement,n=t.videoHeight,o=t.videoWidth;e({cameraStream:r,videoElement:i,videoHeight:n,videoWidth:o})},lastCameraStream:t.lastCameraStream,webcamVideoElement:n,crossOrigin:t.crossOrigin,options:t})},stopVideoStreaming:function(e){e=v.isObject(e)?e:{};var t=e,r=t.cameraStream,i=t.keepCameraOn,n=t.videoElement,o=t.webcamVideoElement;!i&&r&&v.isFunction(r.stop)&&r.stop(),v.isElement(n)&&!o&&(n.pause(),v.isFunction(v.URL.revokeObjectURL)&&!v.webWorkerError&&n.src&&v.URL.revokeObjectURL(n.src),v.removeElement(n))}},O={utils:h,error:b,defaultOptions:C,createGIF:g,takeSnapShot:f,stopVideoStreaming:c,isSupported:e,isWebCamGIFSupported:t,isExistingVideoGIFSupported:i,isExistingImagesGIFSupported:r,VERSION:"0.4.0"};"function"==typeof define&&define.amd?define([],function(){return O}):"undefined"!=typeof exports?module.exports=O:window.gifshot=O}();